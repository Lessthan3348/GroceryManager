<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shopping List with Share & Copy</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background: #121212;
      color: #eee;
    }
    h1 {
      margin-bottom: 1rem;
    }
    .input-row {
      display: flex;
      gap: 10px;
      margin-bottom: 1rem;
    }
    input[type="text"], input[type="number"], select {
      padding: 8px;
      font-size: 1rem;
      flex: 1;
    }
    button {
      cursor: pointer;
      padding: 8px 14px;
      font-size: 1rem;
      background-color: #007bff;
      border: none;
      color: white;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover {
      background-color: #0056b3;
    }
    #autocomplete-list {
      position: relative;
      max-height: 200px;
      overflow-y: auto;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 1rem;
      max-width: 500px;
    }
    .autocomplete-item {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      border-bottom: 1px solid #eee;
      align-items: center;
      font-size: 0.9rem;
    }
    .autocomplete-item:last-child {
      border-bottom: none;
    }
    .autocomplete-item button {
      background-color: #28a745;
      padding: 5px 10px;
      font-size: 0.8rem;
      border-radius: 3px;
      transition: background-color 0.2s ease;
    }
    .autocomplete-item button:hover {
      background-color: #1e7e34;
    }
    ul#list {
      list-style: none;
      padding: 0;
      max-width: 600px;
      margin-bottom: 1rem;
      background: white;
      border-radius: 6px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    ul#list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      border-bottom: 1px solid #ddd;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    ul#list li:last-child {
      border-bottom: none;
    }
    ul#list li:hover {
      background-color: #f9f9f9;
    }
    .list-item-details {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }
    .list-item-name {
      flex: 1;
    }
    input.quantity {
      width: 70px;
      padding: 5px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      text-align: right;
    }
    select {
      padding: 5px;
      font-size: 1rem;
      border-radius: 4px;
    }
    button.remove-btn {
      background-color: #dc3545;
      margin-left: 15px;
      padding: 6px 12px;
      font-size: 0.9rem;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }
    button.remove-btn:hover {
      background-color: #a71d2a;
    }
    .share, .copy-list, .toggle {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .share button {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      background-color: #25d366; /* WhatsApp green */
      color: white;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .share button#share-twitter {
      background-color: #1da1f2;
    }
    .share button:hover {
      filter: brightness(85%);
    }
    .share svg {
      width: 20px;
      height: 20px;
      fill: white;
    }
  </style>
</head>
<body>
  <h1>Shopping List</h1>

  <div class="input-row">
    <input type="text" id="item" placeholder="Enter item name" autocomplete="off" />
    <input type="number" id="quantity" min="0.01" step="0.01" value="1" />
    <select id="unit">
      <option value="st">st</option>
      <option value="kg">kg</option>
      <option value="liter">liter</option>
      <option value="påse">påse</option>
      <option value="dunk">dunk</option>
      <option value="hink">hink</option>
      <option value="flak">flak</option>
      <option value="spray">spray</option>
      <option value="ask">ask</option>
      <option value="knippe">knippe</option>
      <option value="burk">burk</option>
      <option value="kartong">kartong</option>
    </select>
    <button onclick="addItem()">Add</button>
  </div>

  <div id="autocomplete-list"></div>

  <ul id="list"></ul>

  <div class="share">
    <button id="share-whatsapp" title="Share on WhatsApp" onclick="shareWhatsApp()">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M20.52 3.48A11.94 11.94 0 0012 0C5.37 0 0 5.37 0 12a11.88 11.88 0 001.61 6L0 24l6-1.6a11.94 11.94 0 006 1.6c6.63 0 12-5.37 12-12 0-3.2-1.25-6.2-3.48-8.52zm-8.3 17.43c-1.86 0-3.56-.49-5.1-1.33l-.36-.21-3.79 1 1.02-3.68-.23-.37a9.48 9.48 0 01-1.5-4.95c0-5.22 4.24-9.46 9.46-9.46 2.52 0 4.89.98 6.67 2.76a9.44 9.44 0 012.77 6.7 9.47 9.47 0 01-9.47 9.46zm5.27-7.1c-.29-.15-1.7-.83-1.96-.92-.26-.09-.45-.14-.64.14-.18.27-.7.92-.86 1.11-.16.18-.32.2-.6.07a7.78 7.78 0 01-2.29-1.42 8.75 8.75 0 01-1.63-2c-.17-.29-.02-.44.13-.59.13-.13.29-.32.44-.48.15-.16.2-.27.3-.46.1-.18.05-.33-.02-.48-.07-.15-.63-1.53-.87-2.11-.23-.56-.47-.48-.64-.49l-.55-.01a1.06 1.06 0 00-.77.36c-.27.27-1.04 1.01-1.04 2.46s1.07 2.86 1.22 3.06c.15.2 2.1 3.2 5.1 4.49a19.55 19.55 0 002.3.97c.3.13.6.11.83.07.25-.04.78-.31.89-.62.1-.3.1-.55.07-.62-.03-.06-.26-.1-.55-.24z"></path>
      </svg>
      WhatsApp
    </button>

    <button id="share-twitter" title="Share on Twitter" onclick="shareTwitter()">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M23.954 4.569a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723 9.987 9.987 0 01-3.127 1.195 4.92 4.92 0 00-8.384 4.482A13.978 13.978 0 011.67 3.149 4.822 4.822 0 003.16 9.722a4.904 4.904 0 01-2.229-.616v.061a4.918 4.918 0 003.946 4.817 4.996 4.996 0 01-2.224.084 4.936 4.936 0 004.6 3.417 9.867 9.867 0 01-6.102 2.102c-.396 0-.79-.023-1.17-.067a13.945 13.945 0 007.557 2.212c9.054 0 14-7.496 14-13.986 0-.21 0-.42-.015-.63a9.936 9.936 0 002.457-2.548l-.047-.02z"></path>
      </svg>
      Twitter
    </button>
  </div>

  <div class="copy-list" style="margin-top: 1rem;">
    <button onclick="copyListToClipboard()">Copy List to Clipboard</button>
  </div>

  <script>
    const predefinedItems = [
      "1 påse napolitana salads mix",
      "1 kg tomat",
      "1 kg championer",
      "1 kg rödlök",
      "1 st margarin flytande rama",
      "1 dunk olivolja extra virgin 5 L",
      "1 kg gurka ofilmad",
      "1 kg citron",
      "1 hink handskalade räkor",
      "1/2 kg granny smith äpplen gröna",
      "1 flak Ramlösa naturell i burk",
      "1 flak coca cola i burk",
      "1 flak coca cola zero i burk",
      "1 liter standard mjölk",
      "1 spray grädde",
      "1 liter rama grädde",
      "1 påse riven mozzarella ost",
      "1 påse riven grano padano",
      "2 st 500 gram smör red label arla",
      "15 st bakad potatis",
      "5 kg spaghetti",
      "1 chèvre rulle",
      "1 påse mospotatis chefs cut",
      "1 ask ruccola",
      "1 kg lime",
      "1 ask basilika",
      "1 knippe färsk mynta",
      "1 kg apelsin",
      "1 ask salami Milano",
      "1 burk stenbitsrom",
      "1 hink kokta ägg skalade",
      "1 påse jordnötter saltade",
      "1 påse valnötskärnor",
      "1 påse vitlökskrutonger",
      "1 kartong grillad kycklingbröst fryst",
      "1 knippe dill",
      "1 kg tvättad kul potatis",
      "1 roman huvuden",
      "1 st godmorgon apelsinjuice",
      "1 st godmorgon äpple juice",
      "1 flak Sprite i burk",
      "1 kartong mozzarella bollar",
      "1 ask Prochutto crudo",
      "1 kartong fryst lingon",
      "1 crisp sallad"
    ];

    const itemInput = document.getElementById("item");
    const quantityInput = document.getElementById("quantity");
    const unitSelect = document.getElementById("unit");
    const autocompleteList = document.getElementById("autocomplete-list");
    const listElement = document.getElementById("list");

    // Parse item string into qty, unit, and name
    function parseItemString(itemStr) {
      let qty = 1;
      let unit = "st";
      let name = itemStr;

      const parts = itemStr.split(" ");
      if (parts.length > 1) {
        // Try fraction first e.g. 1/2
        if (parts[0].includes("/")) {
          const fractionParts = parts[0].split("/");
          if (fractionParts.length === 2) {
            qty = parseFloat(fractionParts[0]) / parseFloat(fractionParts[1]);
          }
        } else if (!isNaN(parts[0].replace(",", "."))) {
          qty = parseFloat(parts[0].replace(",", "."));
        }

        if (["st","kg","liter","påse","dunk","hink","flak","spray","ask","knippe","burk","kartong"].includes(parts[1])) {
          unit = parts[1];
          name = parts.slice(2).join(" ");
        } else {
          name = parts.slice(1).join(" ");
        }
      }

      return { qty, unit, name };
    }

    // Add item to list
    function addItem(name = null, quantity = null, unit = null, scrollToEnd = true) {
      // If called without args, take from input fields
      if (!name) {
        name = itemInput.value.trim();
        quantity = parseFloat(quantityInput.value);
        unit = unitSelect.value;
      }
      if (!name) return;

      // Prevent duplicates by name+unit
      for (const li of listElement.children) {
        if (
          li.dataset.name.toLowerCase() === name.toLowerCase() &&
          li.dataset.unit === unit
        ) {
          // just update quantity
          const qtyInput = li.querySelector("input.quantity");
          qtyInput.value = (
            parseFloat(qtyInput.value) + (quantity || 1)
          ).toFixed(2);
          return;
        }
      }

      const li = document.createElement("li");
      li.dataset.name = name;
      li.dataset.unit = unit;

      const detailsDiv = document.createElement("div");
      detailsDiv.className = "list-item-details";

      const nameSpan = document.createElement("span");
      nameSpan.textContent = name;
      nameSpan.className = "list-item-name";

      const qtyInput = document.createElement("input");
      qtyInput.type = "number";
      qtyInput.min = "0.01";
      qtyInput.step = "0.01";
      qtyInput.value = (quantity || 1).toFixed(2);
      qtyInput.className = "quantity";
      qtyInput.title = "Adjust quantity";
      qtyInput.addEventListener("change", () => {
        if (parseFloat(qtyInput.value) < 0.01 || isNaN(parseFloat(qtyInput.value))) {
          qtyInput.value = "0.01";
        }
      });

      const unitSelectInList = document.createElement("select");
      ["st", "kg", "liter", "påse", "dunk", "hink", "flak", "spray", "ask", "knippe", "burk", "kartong"].forEach((u) => {
        const option = document.createElement("option");
        option.value = u;
        option.textContent = u;
        unitSelectInList.appendChild(option);
      });
      unitSelectInList.value = unit;
      unitSelectInList.title = "Change unit";
      unitSelectInList.addEventListener("change", () => {
        li.dataset.unit = unitSelectInList.value;
      });

      detailsDiv.appendChild(nameSpan);
      detailsDiv.appendChild(qtyInput);
      detailsDiv.appendChild(unitSelectInList);

      const removeBtn = document.createElement("button");
      removeBtn.textContent = "Remove";
      removeBtn.className = "remove-btn";
      removeBtn.title = "Remove item";
      removeBtn.onclick = () => li.remove();

      li.appendChild(detailsDiv);
      li.appendChild(removeBtn);

      listElement.appendChild(li);

      if (scrollToEnd) {
        listElement.scrollTop = listElement.scrollHeight;
      }
    }

    // Populate autocomplete suggestions with Add button
    function showAutocomplete() {
      autocompleteList.innerHTML = "";
      const val = itemInput.value.toLowerCase();
      if (!val) return;

      const filtered = predefinedItems.filter((item) =>
        item.toLowerCase().includes(val)
      );

      if (filtered.length === 0) return;

      filtered.slice(0, 6).forEach((item) => {
        const itemDiv = document.createElement("div");
        itemDiv.className = "autocomplete-item";

        const textSpan = document.createElement("span");
        textSpan.textContent = item;
        textSpan.style.flex = "1";
        textSpan.style.cursor = "pointer";
        textSpan.title = "Click to autofill";
        textSpan.onclick = () => {
          parseItemForQuantityUnit(item);
          clearAutocomplete();
          quantityInput.focus();
        };

        const addBtn = document.createElement("button");
        addBtn.textContent = "Add";
        addBtn.title = "Add this item";
        addBtn.onclick = () => {
          const { qty, unit, name } = parseItemString(item);
          addItem(name, qty, unit);
          clearAutocomplete();
        };

        itemDiv.appendChild(textSpan);
        itemDiv.appendChild(addBtn);
        autocompleteList.appendChild(itemDiv);
      });
    }

    itemInput.addEventListener("input", showAutocomplete);

    function clearAutocomplete() {
      autocompleteList.innerHTML = "";
    }

    function parseItemForQuantityUnit(item) {
      const { qty, unit, name } = parseItemString(item);
      quantityInput.value = qty.toFixed(2);
      unitSelect.value = unit;
      itemInput.value = name;
    }

    // Share on WhatsApp
    function shareWhatsApp() {
      const text = generateListText();
      const urlEncoded = encodeURIComponent(text);
      const whatsappUrl = `https://wa.me/?text=${urlEncoded}`;
      window.open(whatsappUrl, "_blank");
    }

    // Share on Twitter
    function shareTwitter() {
      let tweet = generateListText();
      if (tweet.length > 280) {
        tweet = tweet.substring(0, 277) + "...";
      }
      const urlEncoded = encodeURIComponent(tweet);
      const twitterUrl = `https://twitter.com/intent/tweet?text=${urlEncoded}`;
      window.open(twitterUrl, "_blank");
    }

    function generateListText() {
      let text = "My Shopping List:\n";
      [...listElement.children].forEach((li, i) => {
        const name = li.dataset.name;
        const qty = li.querySelector("input.quantity").value;
        const unit = li.querySelector("select").value;
        text += `${i + 1}. ${qty} ${unit} ${name}\n`;
      });
      return text.trim();
    }

    // Copy list to clipboard
    function copyListToClipboard() {
      const text = generateListText();
      navigator.clipboard.writeText(text).then(() => {
        alert("Shopping list copied to clipboard!");
      }, () => {
        alert("Failed to copy list to clipboard.");
      });
    }

    // Add item when pressing Enter on item input
    itemInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addItem();
        clearAutocomplete();
        itemInput.focus();
      }
    });

    // Add item when pressing Enter on quantity input
    quantityInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addItem();
        clearAutocomplete();
        itemInput.focus();
      }
    });
  </script>
</body>
</html>

