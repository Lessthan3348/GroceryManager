<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shopping List with Add Buttons</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 1rem;
    display: flex;
    gap: 2rem;
    background: #f9f9f9;
  }
  /* Left column for predefined items */
  .predefined-container {
    width: 300px;
    max-height: 90vh;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 0.5rem;
    background: white;
    border-radius: 6px;
  }
  .predefined-container h2 {
    margin-top: 0;
  }
  .predefined-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
    padding: 4px 8px;
    border-radius: 4px;
    background: #eef3f7;
  }
  .predefined-item:hover {
    background: #d9e2ef;
  }
  .predefined-item button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 4px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .predefined-item button:hover {
    background-color: #0056b3;
  }

  /* Right container for inputs and list */
  .right-container {
    flex-grow: 1;
    max-width: 600px;
    display: flex;
    flex-direction: column;
  }

  label {
    font-weight: bold;
    margin-top: 0.5rem;
  }

  input[type="text"], input[type="number"], select {
    padding: 6px 8px;
    margin-top: 4px;
    border-radius: 4px;
    border: 1px solid #ccc;
    width: 100%;
    box-sizing: border-box;
  }
  input[type="number"] {
    max-width: 100px;
  }

  #autocomplete-list {
    position: relative;
    border: 1px solid #ccc;
    border-top: none;
    max-height: 150px;
    overflow-y: auto;
    background: white;
    z-index: 10;
    border-radius: 0 0 4px 4px;
  }
  .autocomplete-item {
    display: flex;
    justify-content: space-between;
    padding: 6px 8px;
    cursor: pointer;
    align-items: center;
  }
  .autocomplete-item:hover {
    background-color: #f0f0f0;
  }
  .autocomplete-item button {
    margin-left: 10px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .autocomplete-item button:hover {
    background-color: #1e7e34;
  }

  #list {
    margin-top: 1rem;
    padding-left: 0;
    list-style-type: none;
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: white;
  }
  #list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 8px;
    border-bottom: 1px solid #eee;
  }
  #list li:last-child {
    border-bottom: none;
  }
  .list-item-details {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-grow: 1;
  }
  .list-item-name {
    font-weight: 600;
    min-width: 120px;
  }
  input.quantity {
    width: 70px;
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  select {
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  button.remove-btn {
    background-color: #dc3545;
    border: none;
    color: white;
    border-radius: 4px;
    padding: 4px 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  button.remove-btn:hover {
    background-color: #a71d2a;
  }

  .buttons-container {
    margin-top: 1rem;
    display: flex;
    gap: 1rem;
  }
  .buttons-container button {
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    font-weight: 600;
    color: white;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .btn-whatsapp {
    background-color: #25d366;
  }
  .btn-whatsapp:hover {
    background-color: #1ebe5b;
  }
  .btn-twitter {
    background-color: #1da1f2;
  }
  .btn-twitter:hover {
    background-color: #0d8ddb;
  }
  .btn-copy {
    background-color: #6c757d;
  }
  .btn-copy:hover {
    background-color: #565e64;
  }

</style>
</head>
<body>

<!-- Left: Predefined Items -->
<div class="predefined-container">
  <h2>Predefined Items</h2>
  <div id="predefined-list">
    <!-- Items inserted here by JS -->
  </div>
</div>

<!-- Right: Input fields and Shopping List -->
<div class="right-container">
  <label for="item">Item</label>
  <input type="text" id="item" placeholder="Type to search or add new item" autocomplete="off" />
  <div id="autocomplete-list"></div>

  <label for="quantity">Quantity</label>
  <input type="number" id="quantity" value="1" min="0.01" step="0.01" />

  <label for="unit">Unit</label>
  <select id="unit">
    <option value="st">st</option>
    <option value="kg">kg</option>
    <option value="liter">liter</option>
    <option value="påse">påse</option>
    <option value="dunk">dunk</option>
    <option value="hink">hink</option>
    <option value="flak">flak</option>
    <option value="spray">spray</option>
    <option value="ask">ask</option>
    <option value="knippe">knippe</option>
    <option value="burk">burk</option>
    <option value="kartong">kartong</option>
  </select>

  <button style="margin-top: 10px; padding: 8px;" onclick="addItem()">Add to List</button>

  <ul id="list"></ul>

  <div class="buttons-container">
    <button class="btn-whatsapp" onclick="shareWhatsApp()">
      <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" fill="white" viewBox="0 0 24 24">
        <path d="M20.52 3.48a11.91 11.91 0 00-16.83 0A11.91 11.91 0 003.48 20.52l-2.02 6.18 6.18-2.02a11.91 11.91 0 0013.9-13.9zM7.76 17.47l-.61-2.21c-.04-.15-.15-.24-.29-.24H5.88a.23.23 0 01-.21-.15c-.14-.31-.39-.92-.54-1.33-.14-.38.03-.61.21-.71a2.57 2.57 0 011.86-.44c.25.01.42.2.49.39.06.16.13.45.19.66.06.19.03.31-.1.5-.13.18-.27.39-.39.57-.05.08-.03.13.03.23.13.22.6.98.83 1.3.12.18.22.25.37.25.08 0 .18-.01.27-.02.15-.02.63-.25.72-.35.06-.07.06-.13.03-.23a6.49 6.49 0 00-.55-1.13c-.09-.18-.43-.66-.43-.66s-.02-.04-.01-.06c.04-.05.26-.13.34-.17a.87.87 0 011.3.45c.14.3.25.6.36.9.14.39.3.98.36 1.39a1.87 1.87 0 01-1.16 1.73 2.35 2.35 0 01-1.6.24z"/>
      </svg>
      WhatsApp
    </button>

    <button class="btn-twitter" onclick="shareTwitter()">
      <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" fill="white" viewBox="0 0 24 24">
        <path d="M23 3a10.9 10.9 0 01-3.14.86 4.48 4.48 0 001.94-2.48 10.85 10.85 0 01-3.45 1.32 4.52 4.52 0 00-7.69 4.12 12.82 12.82 0 01-9.29-4.7 4.53 4.53 0 001.4 6.05 4.48 4.48 0 01-2.05-.57v.06a4.52 4.52 0 003.62 4.44 4.5 4.5 0 01-2.04.08 4.53 4.53 0 004.23 3.15 9.05 9.05 0 01-5.6 1.93A9.4 9.4 0 010 19.54a12.75 12.75 0 006.92 2.03c8.3 0 12.84-6.87 12.84-12.83 0-.2 0-.39-.01-.58A9.21 9.21 0 0023 3z"/>
      </svg>
      Twitter
    </button>

    <button class="btn-copy" onclick="copyListToClipboard()">
      Copy List to Clipboard
    </button>
  </div>
</div>

<script>
  const predefinedItems = [
    "1 påse napolitana salads mix",
    "1 kg tomat",
    "1 kg championer",
    "1 kg rödlök",
    "1 st margarin flytande rama",
    "1 dunk olivolja extra virgin 5 L",
    "1 kg gurka ofilmad",
    "1 kg citron",
    "1 hink handskalade räkor",
    "1/2 kg granny smith äpplen gröna",
    "1 flak Ramlösa naturell i burk",
    "1 flak coca cola i burk",
    "1 flak coca cola zero i burk",
    "1 liter standard mjölk",
    "1 spray grädde",
    "1 liter rama grädde",
    "1 påse riven mozzarella ost",
    "1 påse riven grano padano",
    "2 st 500 gram smör red label arla",
    "15 st bakad potatis",
    "5 kg spaghetti",
    "1 chèvre rulle",
    "1 påse mospotatis chefs cut",
    "1 ask ruccola",
    "1 kg lime",
    "1 ask basilika",
    "1 knippe färsk mynta",
    "1 kg apelsin",
    "1 ask salami Milano",
    "1 burk stenbitsrom",
    "1 hink kokta ägg skalade",
    "1 påse jordnötter saltade",
    "1 påse valnötskärnor",
    "1 påse vitlökskrutonger",
    "1 kartong grillad kycklingbröst fryst",
    "1 knippe dill",
    "1 kg tvättad kul potatis",
    "1 roman huvuden",
    "1 st godmorgon apelsinjuice",
    "1 st godmorgon äpple juice",
    "1 flak Sprite i burk",
    "1 kartong mozzarella bollar",
    "1 ask Prochutto crudo",
    "1 kartong fryst lingon",
    "1 crisp sallad"
  ];

  const predefinedListDiv = document.getElementById("predefined-list");
  const itemInput = document.getElementById("item");
  const quantityInput = document.getElementById("quantity");
  const unitSelect = document.getElementById("unit");
  const autocompleteList = document.getElementById("autocomplete-list");
  const listElement = document.getElementById("list");

  // Create vertical list with Add buttons on left side
  function renderPredefinedItems() {
    predefinedListDiv.innerHTML = "";
    predefinedItems.forEach((item) => {
      const div = document.createElement("div");
      div.className = "predefined-item";

      const span = document.createElement("span");
      span.textContent = item;

      const addBtn = document.createElement("button");
      addBtn.textContent = "Add";
      addBtn.title = "Add to shopping list";
      addBtn.onclick = () => {
        // Parse quantity, unit, and name from the item string:
        const parsed = parseItemString(item);
        itemInput.value = parsed.name;
        quantityInput.value = parsed.quantity;
        setUnitValue(parsed.unit);
        addItem();
      };

      div.appendChild(span);
      div.appendChild(addBtn);

      predefinedListDiv.appendChild(div);
    });
  }

  function setUnitValue(unit) {
    for (let option of unitSelect.options) {
      if (option.value === unit) {
        unitSelect.value = unit;
        return;
      }
    }
    // If not found, add it dynamically
    let opt = document.createElement("option");
    opt.value = unit;
    opt.textContent = unit;
    unitSelect.appendChild(opt);
    unitSelect.value = unit;
  }

  // Parse string like "1 kg tomat" or "1/2 kg granny smith äpplen gröna"
  function parseItemString(str) {
    // Extract quantity (could be fractional), unit, and name
    const regex = /^([\d\/\.]+)\s+(\S+)\s+(.+)$/;
    const match = str.match(regex);
    if (!match) {
      // fallback: quantity 1, unit st, full string as name
      return { quantity: 1, unit: "st", name: str };
    }
    let quantityStr = match[1];
    let unit = match[2];
    let name = match[3];

    // Convert fraction if needed
    let quantity = 1;
    if (quantityStr.includes("/")) {
      const parts = quantityStr.split("/");
      if (parts.length === 2) {
        quantity = parseFloat(parts[0]) / parseFloat(parts[1]);
      }
    } else {
      quantity = parseFloat(quantityStr);
    }

    return { quantity, unit, name };
  }

  // Add item to list
  function addItem() {
    let name = itemInput.value.trim();
    if (!name) return;

    let quantity = parseFloat(quantityInput.value);
    if (isNaN(quantity) || quantity <= 0) quantity = 1;

    let unit = unitSelect.value || "st";

    // Check if item already exists (by name and unit)
    let existingItem = Array.from(listElement.children).find(
      (li) => li.dataset.name === name && li.dataset.unit === unit
    );

    if (existingItem) {
      // If exists, update quantity
      const qtyInput = existingItem.querySelector("input.quantity");
      qtyInput.value = (parseFloat(qtyInput.value) + quantity).toFixed(2);
    } else {
      // Create new list item
      const li = document.createElement("li");
      li.dataset.name = name;
      li.dataset.unit = unit;

      const detailsDiv = document.createElement("div");
      detailsDiv.className = "list-item-details";

      const nameSpan = document.createElement("span");
      nameSpan.className = "list-item-name";
      nameSpan.textContent = name;

      const qtyInput = document.createElement("input");
      qtyInput.type = "number";
      qtyInput.min = "0.01";
      qtyInput.step = "0.01";
      qtyInput.className = "quantity";
      qtyInput.value = quantity.toFixed(2);

      const unitSelectInner = document.createElement("select");
      ["st", "kg", "liter", "påse", "dunk", "hink", "flak", "spray", "ask", "knippe", "burk", "kartong"].forEach(
        (unitOption) => {
          let option = document.createElement("option");
          option.value = unitOption;
          option.textContent = unitOption;
          if (unitOption === unit) option.selected = true;
          unitSelectInner.appendChild(option);
        }
      );

      // Update dataset unit when changed
      unitSelectInner.addEventListener("change", () => {
        li.dataset.unit = unitSelectInner.value;
      });
      // Update dataset quantity when changed
      qtyInput.addEventListener("change", () => {
        if (qtyInput.value < 0) qtyInput.value = 0;
      });

      detailsDiv.appendChild(nameSpan);
      detailsDiv.appendChild(qtyInput);
      detailsDiv.appendChild(unitSelectInner);

      const removeBtn = document.createElement("button");
      removeBtn.className = "remove-btn";
      removeBtn.textContent = "Remove";
      removeBtn.onclick = () => {
        li.remove();
      };

      li.appendChild(detailsDiv);
      li.appendChild(removeBtn);

      listElement.appendChild(li);
    }

    itemInput.value = "";
    quantityInput.value = 1;
    unitSelect.value = "st";
    clearAutocomplete();
  }

  // Autocomplete filtering
  itemInput.addEventListener("input", () => {
    const val = itemInput.value.toLowerCase();
    autocompleteList.innerHTML = "";

    if (!val) return;

    const filtered = predefinedItems.filter((item) => item.toLowerCase().includes(val));

    filtered.forEach((item) => {
      const div = document.createElement("div");
      div.className = "autocomplete-item";

      const span = document.createElement("span");
      span.textContent = item;
      span.style.cursor = "pointer";

      // Click fills input fields
      span.onclick = () => {
        const parsed = parseItemString(item);
        itemInput.value = parsed.name;
        quantityInput.value = parsed.quantity;
        setUnitValue(parsed.unit);
        clearAutocomplete();
      };

      const addBtn = document.createElement("button");
      addBtn.textContent = "Add";
      addBtn.title = "Add to list";
      addBtn.onclick = (e) => {
        e.stopPropagation();
        const parsed = parseItemString(item);
        itemInput.value = parsed.name;
        quantityInput.value = parsed.quantity;
        setUnitValue(parsed.unit);
        addItem();
        clearAutocomplete();
      };

      div.appendChild(span);
      div.appendChild(addBtn);

      autocompleteList.appendChild(div);
    });
  });

  function clearAutocomplete() {
    autocompleteList.innerHTML = "";
  }

  // Generate list text for sharing/copying
  function generateListText() {
    let text = "";
    const items = listElement.querySelectorAll("li");
    items.forEach((li, i) => {
      const name = li.dataset.name;
      const qty = li.querySelector("input.quantity").value;
      const unit = li.querySelector("select").value;
      text += `${i + 1}. ${qty} ${unit} ${name}\n`;
    });
    return text.trim();
  }

  // Copy list to clipboard
  function copyListToClipboard() {
    const text = generateListText();
    navigator.clipboard.writeText(text).then(() => {
      alert("Shopping list copied to clipboard!");
    }, () => {
      alert("Failed to copy list to clipboard.");
    });
  }

  // Share on WhatsApp
  function shareWhatsApp() {
    const text = encodeURIComponent(generateListText());
    const url = `https://api.whatsapp.com/send?text=${text}`;
    window.open(url, "_blank");
  }

  // Share on Twitter
  function shareTwitter() {
    const text = encodeURIComponent(generateListText());
    const url = `https://twitter.com/intent/tweet?text=${text}`;
    window.open(url, "_blank");
  }

  // Add item on Enter key for item and quantity inputs
  itemInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      addItem();
      clearAutocomplete();
      itemInput.focus();
    }
  });
  quantityInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      addItem();
      clearAutocomplete();
      itemInput.focus();
    }
  });

  renderPredefinedItems();
</script>
</body>
</html>
