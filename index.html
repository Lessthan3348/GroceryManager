<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grocery Manager</title>
  <!-- CSS Variables for Theming -->
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #222222;
      --primary-color: #ff5722;
      --input-bg: #f9f9f9;
      --item-bg: rgba(255, 255, 255, 0.9);
      --whatsapp-color: #25D366;
      --facebook-color: #1877F2;
      --copy-color: #555555;
      --undo-color: #6666ff;
    }
    [data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #dddddd;
      --primary-color: #ff8a50;
      --input-bg: #333333;
      --item-bg: #222222;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      background-image: linear-gradient(135deg, var(--bg-color) 0%, #e0e0e0 100%);
      color: var(--text-color);
      transition: background-color 0.3s, background-image 0.3s, color 0.3s;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    h1 { margin: 0.5rem 0; color: var(--primary-color); font-size: 2rem; }
    .controls {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    button {
      background: var(--primary-color);
      color: #ffffff;
      border: none;
      border-radius: 0.5rem;
      padding: 0.6rem 1rem;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
    }
    button:hover { opacity: 0.9; transform: scale(1.05); }
    .share-btn { font-weight: bold; }
    .whatsapp { background: var(--whatsapp-color); color: #fff; }
    .facebook { background: var(--facebook-color); color: #fff; }
    .copy { background: var(--copy-color); color: #fff; }
    .undo { background: var(--undo-color); color: #fff; }
    .share-btn:hover { transform: scale(1.1); }
    main { flex: 1; display: grid; grid-template-columns: 1fr; gap: 1rem; max-width: 800px; margin: 0 auto; width: 100%; }
    .search-wrapper { position: relative; }
    input[type="text"], input[type="number"] {
      width: 100%; padding: 0.8rem;
      border: 1px solid #cccccc;
      border-radius: 0.5rem;
      background: var(--input-bg);
      color: var(--text-color);
      font-size: 1rem;
    }
    #autocomplete { position: absolute; top: 100%; left: 0; right: 0; background: var(--item-bg); max-height: 150px; overflow-y: auto; border: 1px solid #cccccc; border-radius: 0 0 0.5rem 0.5rem; z-index: 10; }
    #autocomplete div { padding: 0.5rem; cursor: pointer; }
    #autocomplete div:hover { background: #eeeeee; }
    #resultCount { font-size: 0.9rem; margin-top: 0.5rem; color: var(--text-color); }
    ul { list-style: none; margin: 0; padding: 0; }
    li.item { background: var(--item-bg); border-radius: 0.5rem; padding: 0.8rem; display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .item-details { display: flex; gap: 0.5rem; align-items: center; }
    .item-details input { width: 4rem; }
  </style>
</head>
<body>
  <header>
    <h1>Grocery Manager</h1>
    <div class="controls">
      <button id="darkToggle">Toggle Theme</button>
      <button id="undoBtn" class="share-btn undo" disabled>Undo Remove</button>
      <button id="copyBtn" class="share-btn copy">Copy List</button>
      <button id="whatsappBtn" class="share-btn whatsapp">Share WhatsApp</button>
      <button id="facebookBtn" class="share-btn facebook">Share Facebook</button>
    </div>
  </header>
  <main>
    <div class="search-wrapper">
      <input type="text" id="search" placeholder="Search items..." autocomplete="off">
      <div id="autocomplete" aria-live="polite"></div>
      <p id="resultCount"></p>
    </div>
    <section>
      <h2>Search Results</h2>
      <ul id="availableList"></ul>
    </section>
    <section>
      <h2>Your List</h2>
      <ul id="groceryList"></ul>
    </section>
  </main>

  <script>
  (() => {
    const items = [
      { name: "Påse Napolitana salads mix", quantity: 1, unit: "påse" },
      { name: "Tomat", quantity: 1, unit: "kg" },
      { name: "Championer", quantity: 1, unit: "kg" },
      { name: "Rödlök", quantity: 1, unit: "kg" },
      { name: "Margarin flytande rama", quantity: 1, unit: "st" },
      { name: "Olivolja extra virgin", quantity: 5, unit: "L" },
      { name: "Gurka ofilmad", quantity: 1, unit: "kg" },
      { name: "Citron", quantity: 1, unit: "kg" },
      { name: "Handskalade räkor", quantity: 1, unit: "hink" },
      { name: "Granny Smith äpplen gröna", quantity: 0.5, unit: "kg" },
      { name: "Ramlösa naturell i burk", quantity: 1, unit: "flak" },
      { name: "Coca Cola i burk", quantity: 1, unit: "flak" },
      { name: "Coca Cola Zero i burk", quantity: 1, unit: "flak" },
      { name: "Standard mjölk", quantity: 1, unit: "L" },
      { name: "Spray grädde", quantity: 1, unit: "st" },
      { name: "Rama grädde", quantity: 1, unit: "L" },
      { name: "Riven mozzarella ost", quantity: 1, unit: "påse" },
      { name: "Riven grano padano", quantity: 1, unit: "påse" },
      { name: "Smör red label Arla", quantity: 2, unit: "x500g" },
      { name: "Bakad potatis", quantity: 15, unit: "st" },
      { name: "Spaghetti", quantity: 5, unit: "kg" },
      { name: "Chèvre rulle", quantity: 1, unit: "st" },
      { name: "Mospotatis chefs cut", quantity: 1, unit: "påse" },
      { name: "Ruccola", quantity: 1, unit: "ask" },
      { name: "Lime", quantity: 1, unit: "kg" },
      { name: "Basilika", quantity: 1, unit: "ask" },
      { name: "Färsk mynta", quantity: 1, unit: "knippe" },
      { name: "Apelsin", quantity: 1, unit: "kg" },
      { name: "Salami Milano", quantity: 1, unit: "ask" },
      { name: "Stenbitsrom", quantity: 1, unit: "burk" },
      { name: "Kokta ägg skalade", quantity: 1, unit: "hink" },
      { name: "Jordnötter saltade", quantity: 1, unit: "påse" },
      { name: "Valnötskärnor", quantity: 1, unit: "påse" },
      { name: "Vitlökskrutonger", quantity: 1, unit: "påse" },
      { name: "Grillad kycklingbröst fryst", quantity: 1, unit: "kartong" },
      { name: "Dill", quantity: 1, unit: "knippe" },
      { name: "Tvättad kul potatis", quantity: 1, unit: "kg" },
      { name: "Roman huvuden", quantity: 1, unit: "st" },
      { name: "Godmorgon apelsinjuice", quantity: 1, unit: "st" },
      { name: "Godmorgon äpple juice", quantity: 1, unit: "st" },
      { name: "Sprite i burk", quantity: 1, unit: "flak" },
      { name: "Mozzarella bollar", quantity: 1, unit: "kartong" },
      { name: "Prochutto crudo", quantity: 1, unit: "ask" },
      { name: "Fryst lingon", quantity: 1, unit: "kartong" },
      { name: "Crisp sallad", quantity: 1, unit: "st" }
    ];

    const searchInput = document.getElementById('search');
    const availableList = document.getElementById('availableList');
    const groceryList = document.getElementById('groceryList');
    const darkToggle = document.getElementById('darkToggle');
    const undoBtn = document.getElementById('undoBtn');
    const autocompleteBox = document.getElementById('autocomplete');
    const resultCount = document.getElementById('resultCount');
    const copyBtn = document.getElementById('copyBtn');
    const whatsappBtn = document.getElementById('whatsappBtn');
    const facebookBtn = document.getElementById('facebookBtn');

    let state = {
      // Pre-load all items unless overridden
      grocery: JSON.parse(localStorage.getItem('grocery')) || items.slice(),
      dark: JSON.parse(localStorage.getItem('dark')) || false,
      lastRemoved: null
    };

    const saveState = () => {
      localStorage.setItem('grocery', JSON.stringify(state.grocery));
      localStorage.setItem('dark', JSON.stringify(state.dark));
    };

    const getListText = () =>
      state.grocery.map(i => `${i.name} (${i.quantity} ${i.unit})`).join('\n');

    const shareWhatsApp = () =>
      window.open(
        `https://api.whatsapp.com/send?text=${encodeURIComponent(getListText())}`,
        '_blank'
      );
    const shareFacebook = () =>
      window.open(
        `https://www.facebook.com/sharer/sharer.php?u=&quote=${encodeURIComponent(getListText())}`,
        '_blank'
      );
    const copyToClipboard = () => {
      navigator.clipboard.writeText(getListText());
      copyBtn.textContent = 'Copied!';
      setTimeout(() => (copyBtn.textContent = 'Copy List'), 2000);
    };

    const undoRemove = () => {
      if (state.lastRemoved) {
        state.grocery.push(state.lastRemoved);
        state.lastRemoved = null;
        undoBtn.disabled = true;
        saveState();
        render();
      }
    };

    const render = () => {
      document.documentElement.setAttribute(
        'data-theme',
        state.dark ? 'dark' : ''
      );
      // Search results
      availableList.innerHTML = '';
      const query = searchInput.value.trim().toLowerCase();
      const filtered = items.filter(
        i =>
          !state.grocery.find(g => g.name === i.name) &&
          i.name.toLowerCase().includes(query)
      );
      resultCount.textContent = `Found ${filtered.length} items`;
      filtered.forEach(item => {
        const li = document.createElement('li');
        li.className = 'item';
        li.innerHTML = `<span>${item.name} (${item.quantity} ${item.unit})</span>
                        <button data-add="${item.name}">Add</button>`;
        availableList.appendChild(li);
      });
      if (filtered.length === 0)
        availableList.innerHTML = '<li>No items found</li>';

      // Grocery list
      groceryList.innerHTML = '';
      state.grocery.forEach((item, idx) => {
        const li = document.createElement('li');
        li.className = 'item';
        li.innerHTML = `<span>${item.name}</span>
                        <div class="item-details">
                          <input type="number" data-idx="${idx}" data-field="quantity" value="${item.quantity}" min="0">
                          <input type="text" data-idx="${idx}" data-field="unit" value="${item.unit}">
                          <button data-remove="${item.name}">Remove</button>
                        </div>`;
        groceryList.appendChild(li);
      });
    };

    const debounce = (fn, delay = 300) => {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => fn(...args), delay);
      };
    };

    // Event listeners
    searchInput.addEventListener('input', debounce(render));
    copyBtn.addEventListener('click', copyToClipboard);
    whatsappBtn.addEventListener('click', shareWhatsApp);
    facebookBtn.addEventListener('click', shareFacebook);
    undoBtn.addEventListener('click', undoRemove);

    document.body.addEventListener('click', e => {
      const addName = e.target.dataset.add;
      const removeName = e.target.dataset.remove;
      if (addName) {
        state.grocery.push({ ...items.find(i => i.name === addName) });
        saveState();
        render();
      }
      if (removeName) {
        const removed = state.grocery.find(i => i.name === removeName);
        state.lastRemoved = removed;
        state.grocery = state.grocery.filter(i => i.name !== removeName);
        undoBtn.disabled = false;
        saveState();
        render();
      }
      if (e.target === darkToggle) {
        state.dark = !state.dark;
        saveState();
        render();
      }
    });

    groceryList.addEventListener('change', e => {
      const idx = e.target.dataset.idx;
      const field = e.target.dataset.field;
      if (idx != null && field) {
        state.grocery[idx][field] = e.target.value;
        saveState();
      }
    });

    // Initial render
    render();
  })();
  </script>
</body>
</html>
